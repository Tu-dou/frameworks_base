From b1ef80ff3f1f6a8d75e43f694e0236f99c242e20 Mon Sep 17 00:00:00 2001
From: sdhz150 <yanghui140@gmail.com>
Date: Wed, 5 Oct 2016 13:10:34 +0800
Subject: [PATCH] =?UTF-8?q?=E4=BF=AE=E6=AD=A3MediaScannerConnection?=
 =?UTF-8?q?=E5=86=85=E5=AD=98=E6=B3=84=E6=BC=8F?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Change-Id: I04b9a104bbb30ed8b59bca2da0ccc2c9a97e1af8
---
 media/java/android/media/MediaScannerConnection.java | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/media/java/android/media/MediaScannerConnection.java b/media/java/android/media/MediaScannerConnection.java
index d714672..471fa2c 100644
--- a/media/java/android/media/MediaScannerConnection.java
+++ b/media/java/android/media/MediaScannerConnection.java
@@ -133,6 +133,10 @@ public void disconnect() {
                 }
                 try {
                     mContext.unbindService(this);
+                    if (mClient instanceof ClientProxy) {
+                        mClient = null;
+                    }
+                    mService = null;
                 } catch (IllegalArgumentException ex) {
                     if (false) {
                         Log.v(TAG, "disconnect failed: " + ex);
@@ -205,6 +209,7 @@ public void onScanCompleted(String path, Uri uri) {
         void scanNextPath() {
             if (mNextPath >= mPaths.length) {
                 mConnection.disconnect();
+                mConnection = null;
                 return;
             }
             String mimeType = mMimeTypes != null ? mMimeTypes[mNextPath] : null;
